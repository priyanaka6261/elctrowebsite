{% extends 'header.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://js.stripe.com/v3/"></script>
</head>
<body>
<!-- SECTION -->


		<!-- SECTION -->
		<div class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">

					<!-- section title -->
					<div class="col-md-12">
						<div class="section-title">
							{% if carts %}
							<h3 class="title">Total Products - {{carts.count}}</h3>
							{% else %}
							<h3 class="title">No Products in Cart</h3>
							{% endif %}
							<div class="section-nav">
								<ul class="section-tab-nav tab-nav">
									<li class="active"><a href="{% url 'seller-view-product'%}">ALL</a></li>
									<li><a href="{% url 'seller-view-laptop' %}">Laptops</a></li>
									<li><a href="{% url 'seller-view-camera' %}">Cameras</a></li>
									<li><a href="{% url 'seller-view-acsessories' %}">Accessories</a></li>
								</ul>
							</div>
						</div>
					</div>
					<!-- /section title -->

					<!-- Products tab & slick -->
					<div class="col-md-12">
						<div class="row">
							<div class="products-tabs">
								<!-- tab -->
								<div id="tab1" class="tab-pane active">
									<div class="products-slick" data-nav="#slick-nav-1">
										<!-- product -->
										{% for i in carts %}
										<div class="product">
											<div class="product-img">
												<img src="{{i.product.product_image.url}}" alt="" width="250px" height="250px">
												<div class="product-label">
													<span class="sale">-30%</span>
													<span class="new">NEW</span>
												</div>
											</div>
											<div class="product-body">
												<p class="product-category">{{i.product.product_category}}</p>
												<h3 class="product-name"><a href="#">{{i.product_name}}</a></h3>
												<h4 class="product-price"> product price: {{i.product_price}}</h4>


												<form method="post" action="{% url 'change-qty' %}">
													{% csrf_token %}
													<h4 class="product-price">Product Qty:</h4>
													<input type="hidden" name="pk" value="{{i.pk}}">
													<input type="number" name="product_qty" value="{{i.product_qty}}" min="1" max="10" onchange="this.form.submit()">
												</form>
												<h4 class="product-price"> total price: {{i.total_price}}</h4>


														
												<div class="product-rating">
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
													<i class="fa fa-star"></i>
												</div>
												<div class="product-btns">
													
													<a href="{%url 'product-details' pk=i.product.pk %}"><button type="button" class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">Product Detail</span></button>
												</div>
											</div>
											
										</div>
										{% endfor%}
										<!-- /product -->

										
									<div id="slick-nav-1" class="products-slick-nav"></div>
								</div>
								<!-- /tab -->
							</div>
						</div>
					</div>
					<!-- Products tab & slick -->
				</div>
				<!-- /row -->
				<h1>Net Price: â‚¹{{ net_price }}</h1>

<input type="hidden" id="net_price" value="{{ net_price }}">
<input type="hidden" id="csrf_token" value="{% csrf_token %}">

<button id="checkout-button" class="btn btn-lg btn-primary" type="button">Checkout</button>

<script src="https://js.stripe.com/v3/"></script>
<script type="text/javascript">
    const stripe = Stripe("pk_test_51RrDy5JefQwonyf2qBbgpjEotbru9MnHpSCWP7yHNdGoVOJmuwSw9RtqOwxqdgdnbU5o9MiOZ1Ri1ivo17ZjGMvp003iPQClbh");

    document.getElementById("checkout-button").addEventListener("click", function (event) {
        event.preventDefault();  // ðŸš¨ Forcefully block any redirect

        const netPrice = document.getElementById("net_price").value;
        const csrfToken = document.querySelector('input[name=csrfmiddlewaretoken]')?.value || '';

        fetch("/create-checkout-session/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrfToken
            },
            body: JSON.stringify({ amount: netPrice })
        })
        .then(response => response.json())
        .then(data => {
            if (data.id) {
                return stripe.redirectToCheckout({ sessionId: data.id });
            } else {
                console.error("Stripe Error:", data);
                alert("Stripe session failed: " + data.error);
            }
        })
        .catch(error => {
            console.error("JavaScript Error:", error);
            alert("Checkout error. See console.");
        });
    });
</script>



		
	</body>
</html>
{% endblock %}